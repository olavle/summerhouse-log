(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{11:function(e,t,n){},30:function(e,t,n){},31:function(e,t,n){},52:function(e,t,n){},53:function(e,t,n){"use strict";n.r(t);var s=n(1),c=n.n(s),a=n(24),r=n.n(a),i=(n(30),n(4)),o=(n(31),n(8)),u=(n(11),n(0)),l=function(e){var t=e.houses;return Object(u.jsx)("div",{children:t.map((function(e){return Object(u.jsx)("div",{style:{padding:"8px"},children:Object(u.jsx)(o.b,{style:{textDecoration:"none"},to:e.id,children:Object(u.jsxs)("div",{className:"HouseItem",children:[Object(u.jsx)("img",{src:"http://localhost:3001/house.jpeg",style:{maxWidth:"64px",paddingRight:"16px"}}),Object(u.jsx)("p",{children:e.name})]})})},e.id)}))})},d=n(3),j=function(e){return{type:"SET_SHORTAGES",payload:e}},h=function(e){return{type:"SHORTAGEINPUT_OPEN",payload:e}},p=function(e){return{type:"SET_NEW_SHORTAGE",payload:e}},O=function(e){return{type:"SET_MESSAGES",payload:e}},b=function(e){return{type:"SET_NEW_MESSAGE",payload:e}},g=function(e){return{type:"SET_REPLY_INPUT",payload:e}},x={isLoggedIn:!1,username:"",userPassword:"",stayLoggedIn:!1,houses:[],houseToEdit:{id:"",adminId:"",maxResidents:0,name:"",timestamp:"",address:"",imageUrl:"",users:[]},reservations:[],shortages:[],shortageInputOpen:!1,newShortage:"",messages:[],messageReplies:[],newMessageInput:"",newMessageReplyInput:""},f=Object(s.createContext)([x,function(){return x}]),v=function(e){var t=e.reducer,n=e.children,c=Object(s.useReducer)(t,x),a=Object(i.a)(c,2),r=a[0],o=a[1];return Object(u.jsx)(f.Provider,{value:[r,o],children:n})},y=function(){return Object(s.useContext)(f)},m=n(5),E=n.n(m),S=n(9),T=n(10),I=n.n(T),w=I.a.create({withCredentials:!0}),k=function(){var e=Object(S.a)(E.a.mark((function e(t){var n;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I.a.get("".concat(t),{withCredentials:!0});case 2:return n=e.sent,e.next=5,n.data;case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=Object(S.a)(E.a.mark((function e(t,n){var s;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I.a.post("".concat(t),n,{withCredentials:!0});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),N=function(){var e=Object(S.a)(E.a.mark((function e(t,n){var s;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I.a.put("".concat(t),n,{withCredentials:!0});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),_={get:k,post:L,put:N},R=function(){var e=y(),t=Object(i.a)(e,2),n=t[0].houses,s=t[1];return c.a.useEffect((function(){_.get("api/houses").then((function(e){s(function(e){return{type:"HOUSES_FROM_DB",payload:e}}(e))})).catch((function(e){return console.log("err",e)}))}),[]),Object(u.jsx)("div",{children:Object(u.jsx)("div",{className:"HouseList",children:0===n.length?Object(u.jsx)("p",{children:"Ladataan m\xf6kkej\xe4..."}):Object(u.jsx)(l,{houses:n})})})},A=function(){return Object(u.jsx)("div",{children:Object(u.jsx)("p",{children:"Hello home"})})},C=function(){return Object(u.jsx)("div",{children:Object(u.jsx)("p",{children:"Hello Profile"})})},G=n(2),M=(n(52),function(e){var t=e.users;return Object(u.jsxs)("div",{className:"HouseUsersList",children:[Object(u.jsx)("div",{style:{paddingBottom:"8px",borderBottom:"1px solid black"},children:"M\xf6kin k\xe4ytt\xe4j\xe4t:"}),0===t.length?Object(u.jsx)("p",{children:"No users for this house yet"}):t.map((function(e){return Object(u.jsx)("div",{children:Object(u.jsx)("p",{children:e.username})},e.id)}))]})}),P=function(e){return e.split("-").join(".")},H=function(e){var t=e.reservations,n=e.users;return Object(u.jsxs)("div",{className:"ReservationsList",children:[Object(u.jsx)("div",{style:{paddingBottom:"8px",borderBottom:"1px solid black"},children:"Varaukset:"}),Object(u.jsx)("table",{children:Object(u.jsxs)("tbody",{children:[Object(u.jsxs)("tr",{children:[Object(u.jsx)("th",{children:"K\xe4ytt\xe4j\xe4:"}),Object(u.jsx)("th",{children:"Aika:"})]}),t.map((function(e){var t=n.find((function(t){return t.id===e.userWhoAddedId}));return Object(u.jsxs)("tr",{children:[Object(u.jsx)("td",{children:null===t||void 0===t?void 0:t.username}),Object(u.jsxs)("td",{children:[P(e.startingDate)," - ",P(e.endingDate)]})]},e.id)}))]})})]})},U=function(e){var t=e.shortages,n=y(),s=Object(i.a)(n,2),c=s[0],a=c.shortageInputOpen,r=c.newShortage,o=c.houseToEdit,l=s[1];return Object(u.jsxs)("div",{className:"ShortageList",children:[Object(u.jsx)("div",{style:{fontWeight:"bold"},children:"Puutteet:"}),t.map((function(e){return Object(u.jsx)("div",{onClick:function(){return function(e){var n=Object(d.a)(Object(d.a)({},e),{},{isResolved:!e.isResolved});_.put("api/shortages/",n).then((function(s){if(201===s.status){var c=t.map((function(t){return t.id===e.id?n:t}));void 0!==c&&l(j(c))}}))}(e)},children:e.isResolved?Object(u.jsx)("p",{style:{color:"gray",textDecoration:"line-through",cursor:"pointer"},children:e.content}):Object(u.jsx)("p",{style:{cursor:"pointer"},children:e.content})},e.id)})),Object(u.jsx)("div",{style:{fontWeight:"bold",color:"green",cursor:"pointer"},onClick:function(){return l(h(!a))},children:"Lis\xe4\xe4 uusi..."}),a?Object(u.jsxs)("div",{children:[Object(u.jsx)("input",{onChange:function(e){l(p(e.target.value))},type:"text",name:"shortage",placeholder:"Lis\xe4\xe4 puute...",value:r}),Object(u.jsx)("button",{onClick:function(){_.post("api/shortages/".concat(o.id),{content:r}).then((function(e){var n=e.data;l(j(t.concat(n))),l(p("")),l(h(!1))})).catch((function(e){return console.log(e)}))},children:"Lis\xe4\xe4!"})]}):Object(u.jsx)("div",{})]})},D=function(){var e=Object(G.g)().id,t=y(),n=Object(i.a)(t,2),s=n[0],a=s.houseToEdit,r=s.reservations,l=s.shortages,d=n[1];return c.a.useEffect((function(){_.get("api/houses/".concat(e)).then((function(e){d({type:"SET_HOUSE_TO_EDIT",payload:e})})).catch((function(e){return console.log("error:",e)})),_.get("api/reservations/".concat(e)).then((function(e){return d(function(e){return{type:"SET_RESERVATIONS",payload:e}}(e))})).catch((function(e){return console.log(e)})),_.get("api/shortages/".concat(e)).then((function(e){return d(j(e))})).catch((function(e){return console.log(e)}))}),[]),Object(u.jsx)("div",{children:""===a.id?Object(u.jsx)("p",{children:"No such house"}):Object(u.jsxs)("div",{children:[Object(u.jsx)("div",{className:"HouseName",children:a.name}),Object(u.jsxs)("div",{className:"HouseInfoPage",children:[Object(u.jsx)("div",{style:{padding:"26px"},children:Object(u.jsx)(M,{users:a.users})}),Object(u.jsx)("div",{style:{padding:"26px"},children:Object(u.jsx)(H,{reservations:r,users:a.users})}),Object(u.jsx)("div",{style:{padding:"26px"},children:Object(u.jsx)(U,{shortages:l})})]}),Object(u.jsx)(o.b,{to:"messages",children:Object(u.jsx)("div",{children:"Katso m\xf6kkiin liittyvi\xe4 viestej\xe4"})})]})})},W=function(e){var t=e.messages,n=(e.houseToEdit,y()),s=Object(i.a)(n,2),a=s[0],r=a.messageReplies,o=a.newMessageReplyInput,l=s[1],d=c.a.useState([]),j=Object(i.a)(d,2),h=j[0],p=j[1];c.a.useEffect((function(){p([]),console.log("Hello from use effect"),t.forEach((function(e){console.log("The message in question:",e),console.log("Replies:",h),_.get("api/messages/".concat(e.id,"/replies")).then((function(e){e.forEach((function(e){p(h.concat(e))}))})).catch((function(e){return console.log(e)}))})),console.log("replies finally:",h)}),[]);var O=function(e){l(g(e.target.value))};return Object(u.jsx)("div",{className:"MessageArea",children:t.map((function(e){return Object(u.jsx)("div",{style:{padding:"20px"},children:Object(u.jsxs)("div",{className:"MessageThread",children:[Object(u.jsx)("div",{children:e.content}),Object(u.jsxs)("div",{children:["Vastaukset:",0===h.length?Object(u.jsx)("p",{children:"Ei vastauksia"}):r.map((function(t){if(t.originalMessageId===e.id)return Object(u.jsx)("div",{children:t.content},t.id)}))]}),Object(u.jsx)("div",{children:"Vastaa viestiin"}),Object(u.jsx)("textarea",{name:"reply",onChange:O,cols:30,rows:5}),Object(u.jsx)("button",{onClick:function(){return function(e){var t={content:o};console.log(t),_.post("api/messages/".concat(e,"/replies"),t).then((function(e){p(h.concat(e.data)),l(g("")),console.log(e.data)})).catch((function(e){return console.log(e)}))}(e.id)},children:"L\xe4het\xe4 vastaus"})]})},e.id)}))})},B=function(){var e=y(),t=Object(i.a)(e,2),n=t[0],s=n.messages,a=(n.messageReplies,n.newMessageInput),r=n.houseToEdit,o=t[1],l=Object(G.g)().id,d=c.a.useState(!1),j=Object(i.a)(d,2),h=j[0],p=j[1],g=c.a.useState(!1),x=Object(i.a)(g,2);x[0],x[1];c.a.useEffect((function(){_.get("api/messages/".concat(l)).then((function(e){o(O(e))})).catch((function(e){return console.log(e)}))}),[]);return Object(u.jsxs)("div",{children:[Object(u.jsx)("div",{style:{padding:"20px"},children:"Viestit"}),Object(u.jsx)("div",{style:{cursor:"pointer"},onClick:function(){return p(!0)},children:"Lis\xe4\xe4 uusi viesti"}),Object(u.jsx)("div",{children:h?Object(u.jsxs)("div",{children:[Object(u.jsx)("input",{onChange:function(e){o(b(e.target.value))},type:"text",name:"message",placeholder:"Uusi viesti..."}),Object(u.jsx)("button",{onClick:function(){var e={content:a,houseId:l};_.post("api/messages",e).then((function(e){var t=e.data;o(O(s.concat(t))),o(b("")),p(!1)})).catch((function(e){return console.log(e)}))},children:"Lis\xe4\xe4!"})]}):Object(u.jsx)("div",{})}),Object(u.jsx)("div",{className:"MessageArea",children:Object(u.jsx)(W,{messages:s,houseToEdit:r})})]})},V=function(e){var t=e.handleLogout;return Object(u.jsxs)("div",{className:"LoggedInView",children:[Object(u.jsxs)("div",{className:"TopBar",children:[Object(u.jsx)(o.b,{className:"link",to:"/",children:"Etusivu"}),Object(u.jsx)(o.b,{className:"link",to:"/house",children:"M\xf6kit"}),Object(u.jsx)(o.b,{className:"link",to:"/user",children:"Profiili"}),Object(u.jsx)("button",{onClick:t,children:"Kirjaudu ulos"})]}),Object(u.jsxs)(G.c,{children:[Object(u.jsx)(G.a,{path:"/",element:Object(u.jsx)(A,{})}),Object(u.jsx)(G.a,{path:"/house",element:Object(u.jsx)(R,{})}),Object(u.jsx)(G.a,{path:"/user",element:Object(u.jsx)(C,{})}),Object(u.jsx)(G.a,{path:"/house/:id",element:Object(u.jsx)(D,{})}),Object(u.jsx)(G.a,{path:"/house/:id/messages",element:Object(u.jsx)(B,{})})]})]})},F=function(){var e=Object(S.a)(E.a.mark((function e(t){var n;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I.a.post("".concat("http://localhost:3001","/api/login"),t,{withCredentials:!0});case 2:return n=e.sent,e.next=5,n.data;case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),K=function(){var e=Object(S.a)(E.a.mark((function e(){return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.post("api/login/logout");case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Y={login:F,userLoggedIn:function(e){return!!e},logout:K},J=function(){var e=y(),t=Object(i.a)(e,2),n=t[0],s=n.username,c=n.userPassword,a=n.stayLoggedIn,r=t[1],o=function(){var e=Object(S.a)(E.a.mark((function e(){return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Y.login({username:s,password:c,keepLoggedIn:a});case 3:"Logged in!"===e.sent.message?r({type:"LOGIN",payload:!0}):window.alert("Wrong credentials"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return Object(u.jsxs)("div",{children:[Object(u.jsx)("div",{children:"Tervetuloa! Ole hyv\xe4 ja kirjaudu sis\xe4\xe4n"}),Object(u.jsxs)("div",{children:[Object(u.jsx)("label",{htmlFor:"username",children:"K\xe4ytt\xe4j\xe4tunnus"}),Object(u.jsx)("input",{onChange:function(e){r({type:"SET_USERNAME",payload:e.target.value})},type:"text",name:"username",placeholder:"K\xe4ytt\xe4j\xe4tunnus"})]}),Object(u.jsxs)("div",{children:[Object(u.jsx)("label",{htmlFor:"password",children:"Salasana"}),Object(u.jsx)("input",{onChange:function(e){r({type:"SET_PASSWORD",payload:e.target.value})},type:"password",name:"password",placeholder:"Salasana"})]}),Object(u.jsxs)("div",{children:[Object(u.jsx)("label",{htmlFor:"stayLoggedIn",children:"Pysy sis\xe4\xe4nkirjautuneena"}),Object(u.jsx)("input",{checked:a,onChange:function(){r({type:"STAY_LOGGEDIN",payload:!a})},type:"checkbox",name:"stayLoggedIn"})]}),Object(u.jsx)("button",{onClick:o,children:"Login"})]})},q=n(25),z=n.n(q),Q=function(){var e=y(),t=Object(i.a)(e,2),n=t[0].isLoggedIn,s=t[1];c.a.useEffect((function(){Y.userLoggedIn(z.a.get("token"))?s({type:"LOGIN",payload:!0}):s({type:"LOGOUT",payload:!1})}),[n]);return Object(u.jsx)("div",{className:"App",children:n?Object(u.jsx)(V,{handleLogout:function(){Y.logout().then((function(){s({type:"LOGOUT",payload:!1})})).catch((function(e){return console.log(e)}))}}):Object(u.jsx)(J,{})})};r.a.render(Object(u.jsx)(v,{reducer:function(e,t){switch(t.type){case"LOGIN":return Object(d.a)(Object(d.a)({},e),{},{isLoggedIn:!0});case"LOGOUT":return Object(d.a)(Object(d.a)({},e),{},{isLoggedIn:!1});case"SET_USERNAME":return Object(d.a)(Object(d.a)({},e),{},{username:t.payload});case"SET_PASSWORD":return Object(d.a)(Object(d.a)({},e),{},{userPassword:t.payload});case"STAY_LOGGEDIN":return Object(d.a)(Object(d.a)({},e),{},{stayLoggedIn:t.payload});case"HOUSES_FROM_DB":return Object(d.a)(Object(d.a)({},e),{},{houses:t.payload});case"SET_HOUSE_TO_EDIT":return Object(d.a)(Object(d.a)({},e),{},{houseToEdit:t.payload});case"SET_RESERVATIONS":return Object(d.a)(Object(d.a)({},e),{},{reservations:t.payload});case"SET_SHORTAGES":return Object(d.a)(Object(d.a)({},e),{},{shortages:t.payload});case"SHORTAGEINPUT_OPEN":return Object(d.a)(Object(d.a)({},e),{},{shortageInputOpen:t.payload});case"SET_NEW_SHORTAGE":return Object(d.a)(Object(d.a)({},e),{},{newShortage:t.payload});case"SET_MESSAGES":return Object(d.a)(Object(d.a)({},e),{},{messages:t.payload});case"SET_NEW_MESSAGE":return Object(d.a)(Object(d.a)({},e),{},{newMessageInput:t.payload});case"SET_MESSAGE_REPLIES":return Object(d.a)(Object(d.a)({},e),{},{messageReplies:t.payload});case"SET_REPLY_INPUT":return Object(d.a)(Object(d.a)({},e),{},{newMessageReplyInput:t.payload});default:return e}},children:Object(u.jsx)(o.a,{children:Object(u.jsx)(Q,{})})}),document.getElementById("root"))}},[[53,1,2]]]);
//# sourceMappingURL=main.9476d38f.chunk.js.map